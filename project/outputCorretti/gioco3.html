<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Martian Grand Slam - Interactive Quest</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Roboto', sans-serif;
    background: #f9f9f9;
    color: #222;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #game-container {
    max-width: 700px;
    width: 90vw;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
    padding: 24px 32px 32px 32px;
    box-sizing: border-box;
  }
  h1, h2 {
    margin-top: 0;
    color: #1a237e;
  }
  p {
    line-height: 1.5;
    margin-bottom: 1.2em;
  }
  .button-container {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }
  button {
    background: #3949ab;
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 5px;
    font-size: 1rem;
    cursor: pointer;
    flex: 1 1 auto;
    min-width: 140px;
    transition: background-color 0.3s ease;
  }
  button:hover, button:focus {
    background: #303f9f;
    outline: none;
  }
  .dialogue {
    background: #e8eaf6;
    border-left: 4px solid #3949ab;
    padding: 12px 16px;
    margin-bottom: 1.2em;
    font-style: italic;
  }
  .narration {
    margin-bottom: 1.2em;
  }
  footer {
    margin-top: 30px;
    font-size: 0.85rem;
    color: #666;
    text-align: center;
  }
</style>
</head>
<body>
<div id="game-container" role="main" aria-live="polite" aria-atomic="true">
  <!-- Content dynamically inserted here -->
</div>
<footer>Martian Grand Slam Interactive Quest &mdash; Powered by AI Narrative Engine</footer>
<script>
(() => {
  const container = document.getElementById('game-container');

  // Game state variables
  let state = {
    location: 'olympus-arrival-bay',
    hasSponsor: false,
    sponsors: [],
    hasRanking: false,
    hasRacket: false,
    hasSuit: false,
    equipmentUpgraded: false,
    skillImproved: false,
    respectEarned: false,
    evidenceCollected: false,
    vegaCheatingKnown: false,
    vegaSuspended: false,
    tournamentQualified: false,
    tournamentWon: false,
    champion: false,
    planStepIndex: 0
  };

  // Sections data keyed by section number
  // Each section has:
  // - title
  // - narrative (array of paragraphs or dialogues)
  // - actions: array of { text, nextSection }
  // The nextSection corresponds to the section number in the story or special commands for end/restart
  // We will follow the plan steps to guide the story linearly but allow choices as per branching factor

  // To keep the story consistent with the plan steps, we will implement the plan steps in order,
  // but also provide the choices as per the lore.

  // For simplicity, we will implement the plan steps as the main path, with some choices at each step.

  // Mapping section numbers to narrative and choices:
  const sections = {
    1: {
      title: "Arrival at Olympus Station",
      narrative: [
        "You are Nova Racket, a young Earth-born tennis prodigy, newly arrived at Olympus Station on Mars.",
        "You have no sponsor, no ranking, and your equipment is outdated. The reigning Martian champion, Vega Stratos, is rumored to be cheating.",
        "Rival players form cliques that block your entry to tournaments.",
        "Your goal is to qualify for the Martian league matches, acquire better equipment, earn sponsors, uncover Vega's cheating, win the Olympus Trials, and ultimately face Vega in the final championship on Europa."
      ],
      actions: [
        { text: "Explore Olympus Station market to look for equipment upgrades", next: 2 },
        { text: "Visit local training center to practice and scout rivals", next: 3 },
        { text: "Attend social gathering to network and seek sponsors", next: 4 }
      ]
    },
    2: {
      title: "Olympus Station Market",
      narrative: [
        "You arrive at the bustling Olympus Station market, filled with vendors selling various sports equipment and tech upgrades.",
        "Some vendors eye you suspiciously, noting your lack of ranking.",
        "You search for a high-tech racket and suit to improve your performance."
      ],
      actions: [
        { text: "Negotiate with a vendor selling a high-tech racket", next: 5 },
        { text: "Search for a sponsor among vendors who support athletes", next: 6 },
        { text: "Return to training center to test current equipment", next: 3 }
      ]
    },
    3: {
      title: "Local Training Center",
      narrative: [
        "At the training center, you practice your skills and observe rival players.",
        "The rival cliques remain exclusive, blocking your entry to official tournaments.",
        "Your skills improve slightly despite your outdated gear."
      ],
      actions: [
        { text: "Challenge a mid-level rival to a friendly match to earn respect", next: 7 },
        { text: "Approach coach for advice on qualifying for official matches", next: 8 },
        { text: "Return to market to seek equipment upgrades", next: 2 }
      ]
    },
    4: {
      title: "Social Gathering at Olympus Station",
      narrative: [
        "You attend a social lounge gathering, seeking sponsors.",
        "Several planetary sponsors are present but cautious about new players.",
        "Rival clique members watch your interactions closely."
      ],
      actions: [
        { text: "Pitch to a tech corporation sponsor interested in innovation", next: 9 },
        { text: "Network with a sports gear company that could supply equipment", next: 6 },
        { text: "Attempt to gain favor with a rival sponsor to weaken cliques", next: 10 }
      ]
    },
    5: {
      title: "Negotiating for High-Tech Racket",
      narrative: [
        "You negotiate with a vendor selling a high-tech racket.",
        "The vendor agrees to sell it but requests proof of your potential for sponsorship or ranking."
      ],
      actions: [
        { text: "Use new racket to challenge a rival for tournament qualification", next: 7 },
        { text: "Seek sponsorship to afford a high-tech suit", next: 6 },
        { text: "Return to social gathering to find sponsors", next: 4 }
      ],
      onEnter: () => {
        state.hasRacket = true;
        state.equipmentUpgraded = true;
      }
    },
    6: {
      title: "Seeking Sponsors",
      narrative: [
        "You engage in talks with potential sponsors, but none have committed yet.",
        "They want proof of your skill or integrity before committing."
      ],
      actions: [
        { text: "Enter local qualifiers to prove skill", next: 11 },
        { text: "Investigate rumors about Vega’s cheating to gather leverage", next: 12 },
        { text: "Train intensively to prepare for Olympus Trials", next: 8 }
      ]
    },
    7: {
      title: "Friendly Match with Rival",
      narrative: [
        "You challenge a mid-level rival to a friendly match.",
        "Your performance here could earn you respect and improve your chances to enter tournaments."
      ],
      actions: [
        { text: "Apply for Martian league qualifiers", next: 11 },
        { text: "Seek sponsorship leveraging new respect", next: 6 },
        { text: "Investigate Vega’s rumored cheating", next: 12 }
      ],
      onEnter: () => {
        // Simulate winning the match and earning respect
        state.respectEarned = true;
      }
    },
    8: {
      title: "Training and Coaching",
      narrative: [
        "You approach the coach for advice and train intensively.",
        "Your skills improve and you gain a better understanding of the qualification process."
      ],
      actions: [
        { text: "Register for Martian league qualifiers", next: 11 },
        { text: "Investigate Vega’s cheating rumors with coach’s help", next: 12 },
        { text: "Network for sponsors at social events", next: 4 }
      ],
      onEnter: () => {
        state.skillImproved = true;
      }
    },
    9: {
      title: "Pitching to Tech Corporation Sponsor",
      narrative: [
        "You pitch your innovative equipment ideas to a tech corporation sponsor.",
        "They are impressed but want to see a demonstration of your skill."
      ],
      actions: [
        { text: "Enter qualifiers to prove worth", next: 11 },
        { text: "Use sponsor contacts to investigate Vega’s cheating", next: 12 },
        { text: "Train with new resources", next: 8 }
      ]
    },
    10: {
      title: "Gaining Favor with Rival Sponsor",
      narrative: [
        "You attempt to gain favor with a rival sponsor to weaken the cliques.",
        "The sponsor is intrigued but cautious; rivals may retaliate if you are seen as a threat."
      ],
      actions: [
        { text: "Accept sponsor offer and prepare for qualifiers", next: 11 },
        { text: "Use sponsor’s influence to challenge rival cliques", next: 13 },
        { text: "Investigate Vega’s cheating rumors", next: 12 }
      ]
    },
    11: {
      title: "Martian League Qualifiers",
      narrative: [
        "You compete in the Martian league qualifiers, fighting for official ranking and tournament qualification.",
        "Rivals are present, some hostile.",
        state.hasRacket ? "You wield your high-tech racket, feeling confident." : "You rely on your old gear, determined to prove yourself."
      ],
      actions: [
        { text: "Win qualifier match to enter Olympus Trials", next: 14 },
        { text: "Lose and try to negotiate wildcard entry with sponsors", next: 6 },
        { text: "Challenge rival players to friendly matches to improve standing", next: 7 }
      ],
      onEnter: () => {
        state.tournamentQualified = true;
        state.hasRanking = true;
      }
    },
    12: {
      title: "Investigating Vega’s Cheating Rumors",
      narrative: [
        "You investigate rumors about Vega’s illegal tech use, gathering evidence.",
        "There is risk of being caught spying, but you manage to collect partial evidence."
      ],
      actions: [
        { text: "Present evidence to Martian league officials", next: 15 },
        { text: "Confront Vega directly with accusations", next: 16 },
        { text: "Use evidence to gain sponsor support", next: 6 }
      ],
      onEnter: () => {
        state.evidenceCollected = true;
        state.vegaCheatingKnown = true;
      }
    },
    13: {
      title: "Challenging Rival Cliques",
      narrative: [
        "Using your sponsor’s influence, you challenge the rival cliques.",
        "Their power weakens, and access to tournaments becomes easier.",
        "Your sponsor support solidifies."
      ],
      actions: [
        { text: "Register for Martian league qualifiers", next: 11 },
        { text: "Focus on training for Olympus Trials", next: 8 },
        { text: "Continue networking for more sponsors", next: 4 }
      ],
      onEnter: () => {
        state.hasSponsor = true;
      }
    },
    14: {
      title: "Olympus Trials Tournament",
      narrative: [
        "You have qualified for the prestigious Olympus Trials tournament.",
        "Equipped with improved gear and growing sponsor support, you prepare to face Vega Stratos, who is readying for the final matches."
      ],
      actions: [
        { text: "Compete in Olympus Trials matches", next: 17 },
        { text: "Investigate Vega’s cheating rumors further", next: 12 },
        { text: "Secure final sponsorship deals", next: 6 }
      ]
    },
    15: {
      title: "Presenting Evidence to Officials",
      narrative: [
        "You present the evidence of Vega’s cheating to the Martian league officials.",
        "They review the evidence and decide to suspend Vega temporarily."
      ],
      actions: [
        { text: "Use Vega’s suspension to advance in tournaments", next: 17 },
        { text: "Continue training for finals", next: 8 },
        { text: "Secure sponsors impressed by your integrity", next: 6 }
      ],
      onEnter: () => {
        state.vegaSuspended = true;
      }
    },
    16: {
      title: "Confronting Vega",
      narrative: [
        "You confront Vega directly with accusations of cheating.",
        "Vega denies the allegations and reacts aggressively, escalating tensions."
      ],
      actions: [
        { text: "Escalate conflict to league officials", next: 15 },
        { text: "Focus on winning fairly despite tension", next: 17 },
        { text: "Rally sponsor and public support", next: 6 }
      ]
    },
    17: {
      title: "Olympus Trials Final Rounds",
      narrative: [
        "You are in the final rounds of the Olympus Trials, close to winning the tournament and earning your ranking.",
        state.vegaSuspended ? "Vega Stratos is suspended and absent from the matches." : "Vega Stratos is your formidable opponent in the finals.",
        "Your sponsors are committed and your equipment is top-notch."
      ],
      actions: [
        { text: "Win Olympus Trials final match", next: 18 },
        state.vegaSuspended ? { text: "Claim title by default and prepare for Europa", next: 19 } : null,
        { text: "Investigate and prepare for final championship on Europa", next: 20 }
      ].filter(Boolean)
    },
    18: {
      title: "Olympus Trials Champion",
      narrative: [
        "You have won the Olympus Trials final match, becoming the champion and qualifying for the Europa championship.",
        "Vega Stratos has been defeated or remains under suspicion.",
        "Your sponsors are secured and your future looks bright."
      ],
      actions: [
        { text: "Travel to Europa for final championship", next: 20 },
        { text: "Train intensively for zero-gravity final match", next: 21 }
      ],
      onEnter: () => {
        state.tournamentWon = true;
      }
    },
    19: {
      title: "Claiming Title by Default",
      narrative: [
        "With Vega suspended, you claim the Olympus Trials title by default.",
        "Sponsors are impressed by your fair play and integrity.",
        "You prepare for the final championship on Europa."
      ],
      actions: [
        { text: "Prepare for Europa final match", next: 20 },
        { text: "Use downtime to improve skills", next: 21 }
      ],
      onEnter: () => {
        state.tournamentWon = true;
      }
    },
    20: {
      title: "Europa Grand Arena",
      narrative: [
        "You arrive at the Europa Grand Arena for the final Intergalactic Tennis Championship.",
        "Equipped with a high-tech racket and suit adapted for zero gravity, you are ready.",
        state.vegaSuspended ? "Vega Stratos is absent due to suspension." : "Vega Stratos is present and your final opponent."
      ],
      actions: [
        { text: "Face Vega Stratos in final zero-gravity match", next: 22 },
        { text: "Attempt to gather last-minute intel on Vega’s equipment", next: 12 }
      ]
    },
    21: {
      title: "Training for Zero-Gravity Final Match",
      narrative: [
        "You train intensively at the Europa training facility, optimizing your skills for zero gravity.",
        "Your equipment is fully upgraded and your mental preparation is complete."
      ],
      actions: [
        { text: "Enter final championship match against Vega", next: 22 },
        { text: "Review strategy and rest before match", next: 22 }
      ],
      onEnter: () => {
        state.skillImproved = true;
        state.equipmentUpgraded = true;
      }
    },
    22: {
      title: "Final Zero-Gravity Match",
      narrative: [
        "The final match against Vega Stratos begins in the zero-gravity conditions of the Europa Grand Arena.",
        "Both players are at peak performance, and the match is intense."
      ],
      actions: [
        { text: "Win final match and become Intergalactic Tennis Champion", next: 23 },
        { text: "Lose match and accept runner-up status", next: 24 }
      ]
    },
    23: {
      title: "Intergalactic Tennis Champion!",
      narrative: [
        "Congratulations! You, Nova Racket, have been crowned the Intergalactic Tennis Champion at the Europa Grand Arena.",
        "Your sponsors are secured, and Vega Stratos has been defeated or sanctioned.",
        "Your journey has reached its triumphant conclusion."
      ],
      actions: [
        { text: "Celebrate victory and plan future career", next: "end" }
      ],
      onEnter: () => {
        state.champion = true;
      }
    },
    24: {
      title: "Runner-Up Status",
      narrative: [
        "You fought valiantly but lost the final match to Vega Stratos.",
        "Your sponsors remain supportive, and you have potential for a rematch in the future.",
        "This is not the end of your journey."
      ],
      actions: [
        { text: "Plan training for next championship", next: 21 },
        { text: "Seek new sponsors and strategies", next: 4 }
      ]
    }
  };

  // Starting page content
  function renderStartPage() {
    container.innerHTML = `
      <h1>Martian Grand Slam</h1>
      <p><strong>Story Summary:</strong></p>
      <p>In the futuristic colony of Olympus Station on Mars, tennis has evolved into a high-tech spectacle played across the solar system. You are Nova Racket, a young Earth-born tennis prodigy determined to become the Intergalactic Tennis Champion.</p>
      <p>Starting with no sponsor, no ranking, and outdated equipment, you must navigate rival cliques, upgrade your gear, earn sponsors, uncover cheating by the reigning Martian champion Vega Stratos, and win the grueling tournaments leading to the final championship on Europa.</p>
      <div class="button-container">
        <button id="start-btn" aria-label="Start the Martian Grand Slam game">Start Game</button>
      </div>
    `;
    document.getElementById('start-btn').focus();
    document.getElementById('start-btn').onclick = () => {
      startGame();
    };
  }

  // Render a section by its number
  function renderSection(sectionNum) {
    const section = sections[sectionNum];
    if (!section) {
      renderError("Section not found.");
      return;
    }
    if (section.onEnter) section.onEnter();

    // Compose narrative paragraphs and dialogues
    let narrativeHtml = '';
    section.narrative.forEach(paragraph => {
      if (paragraph.startsWith('"') && paragraph.endsWith('"')) {
        // Dialogue style
        narrativeHtml += `<div class="dialogue">${paragraph.replace(/^"|"$/g, '')}</div>`;
      } else {
        narrativeHtml += `<p class="narration">${paragraph}</p>`;
      }
    });

    // Compose action buttons
    let buttonsHtml = '';
    section.actions.forEach((action, idx) => {
      buttonsHtml += `<button data-next="${action.next}" aria-label="Choose action: ${action.text}">${action.text}</button>`;
    });

    container.innerHTML = `
      <h2>${section.title}</h2>
      ${narrativeHtml}
      <div class="button-container" role="group" aria-label="Available actions">
        ${buttonsHtml}
      </div>
    `;

    // Add event listeners to buttons
    const buttons = container.querySelectorAll('button[data-next]');
    buttons.forEach(button => {
      button.onclick = () => {
        const next = button.getAttribute('data-next');
        if (next === 'end') {
          renderEndPage();
        } else {
          renderSection(next);
        }
      };
    });

    // Focus first button for accessibility
    if (buttons.length) buttons[0].focus();
  }

  // Render error message
  function renderError(message) {
    container.innerHTML = `
      <h2>Error</h2>
      <p>${message}</p>
      <div class="button-container">
        <button id="restart-btn">Restart Game</button>
      </div>
    `;
    document.getElementById('restart-btn').onclick = () => {
      renderStartPage();
    };
  }

  // Render end page with play again option
  function renderEndPage() {
    container.innerHTML = `
      <h2>Thank you for playing!</h2>
      <p>Your journey as Nova Racket in the Martian Grand Slam has concluded.</p>
      <div class="button-container">
        <button id="play-again-btn" aria-label="Play the game again">Play Again</button>
      </div>
    `;
    document.getElementById('play-again-btn').focus();
    document.getElementById('play-again-btn').onclick = () => {
      resetState();
      renderStartPage();
    };
  }

  // Reset game state to initial
  function resetState() {
    state = {
      location: 'olympus-arrival-bay',
      hasSponsor: false,
      sponsors: [],
      hasRanking: false,
      hasRacket: false,
      hasSuit: false,
      equipmentUpgraded: false,
      skillImproved: false,
      respectEarned: false,
      evidenceCollected: false,
      vegaCheatingKnown: false,
      vegaSuspended: false,
      tournamentQualified: false,
      tournamentWon: false,
      champion: false,
      planStepIndex: 0
    };
  }

  // Start the game from section 1
  function startGame() {
    resetState();
    renderSection(1);
  }

  // Initialize game on page load
  renderStartPage();
})();
</script>
</body>
</html>